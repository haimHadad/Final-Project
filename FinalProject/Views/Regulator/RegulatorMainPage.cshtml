@model FinalProject.Models.DappAccount
@{
    ViewData["Title"] = "RegulatorMainPage";
    Layout = "~/Views/Shared/_LayoutRegulator.cshtml";
}
<br />


@if (@Model.DeployedContractList == null)
{
    <br />
    <br />
    <div class="row justify-content-center"><h2>There are NO Previus Requests.</h2></div>
}
else
{
    <!--<div class="row justify-content-center"><button class="btn btn-light">Refresh Table</button></div>-->
    <br />
    <br />
    <table class=" table table-hover">
        <thead align="center">
            <tr>
                <th scope="col">AssetID</th>
                <th scope="col">Contract's Address</th>
                <th scope="col">Tracking</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody align="center">
            @foreach (var a in @Model.DeployedContractList)
            {
                var ContractSerialModel = Newtonsoft.Json.JsonConvert.SerializeObject(a);
                
            <tr>
                <td>@a.AssetID</td>
                <td>@a.ContractAddress</td>
                <td><a target="_blank" href=@a.EtherscanURL>Here</a></td>
                <td><button class="btn btn-primary" data-toggle="modal" data-target="#ContractDetailsDialog" onclick="ViewContractDeteils( @ContractSerialModel)" >View Details</button></td>
            </tr>
            }
        </tbody>
    </table>
}
<div class="modal fade" id="ContractDetailsDialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="dialogTitle">Contract Details</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="asset_dialog_body">
                <center><img class="w-50" id="DialogImageURL"></center>
                <p id="ContractDialogAssetID"></p>
                <p id="ContractDialogLoaction"></p>
                <p id="ContractDialogAreaIn"></p>
                <p id="ContractDialogRooms"></p>
                <p id="ContractDialogPrice"></p>
                <p id="">------------------------------------</p>
                <p id="ContractDialogOwnerID"></p>
                <p id="ContractDialogOwnerPublicKey"></p>
                <p id="">------------------------------------</p>
                <p id="ContractDialogBuyerID"></p>
                <p id="ContractDialogBuyerPublicKey"></p>
                <p id="">------------------------------------</p>
                <p id="ContractDialogNewOwnerID"></p>
                <p id="ContractDialogNewOwnerPublicKey"></p>
                <h5 id="ContractDialogResult"></h5>
                <textarea id="ContractdialogNotes" rows="4" cols="50"></textarea>
            </div>
            <div class="modal-footer justify-content-around">
                <button type="button" class="btn btn-primary" data-dismiss="modal">close</button>
            </div>
        </div>
    </div>
</div>
@section scripts
{
    <script type="text/javascript">
        $(document).ready(function () {
            document.getElementById("navBarRegulatorHome").style.textDecoration = "underline";
            document.getElementById("navBarRegulatorHome").style.fontWeight = "bold";
        });

        function ViewContractDeteils(offer)
        {
            
            console.log("ID is : -->"+offer.OwnerID);
            var fullPublicKey = offer.SellerPublicKey;
            var partOne = fullPublicKey.substring(0, 12);
            var partTwo = " . . . ";
            var partThree = fullPublicKey.substring(32, fullPublicKey.length);
            var OwnerPublicKeyToShow = "" + partOne + partTwo + partThree;

            var fullPublicKey = offer.BuyerPublicKey;
            var partOne = fullPublicKey.substring(0, 12);
            var partTwo = " . . . ";
            var partThree = fullPublicKey.substring(32, fullPublicKey.length);
            var BuyerPublicKeyToShow = "" + partOne + partTwo + partThree;

            


            document.getElementById("DialogImageURL").setAttribute("src", offer.ImageURL);
            document.getElementById("ContractDialogAssetID").innerHTML = "Asset No : ".bold() + offer.AssetID;
            document.getElementById("ContractDialogLoaction").innerHTML = "Loaction : ".bold() + offer.Loaction;
            document.getElementById("ContractDialogAreaIn").innerHTML = "AreaIn : ".bold() + offer.AreaIn +" m^2";
            document.getElementById("ContractDialogRooms").innerHTML = "Rooms :".bold() + offer.Rooms;

            var dealPriceILS = offer.PriceILS.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            var dealPriceETH = offer.PriceETH
            var dealPrice = "" + dealPriceETH + " ETH | ₪" + dealPriceILS;
            document.getElementById("ContractDialogPrice").innerHTML = "Price : ".bold() + dealPrice;
            document.getElementById("ContractDialogOwnerID").innerHTML = "Owner ID : ".bold() + offer.OwnertID;
            document.getElementById("ContractDialogOwnerPublicKey").innerHTML = "Owner Public-Key : ".bold() + OwnerPublicKeyToShow;
            document.getElementById("ContractDialogBuyerID").innerHTML = "Buyer ID : ".bold() + offer.BuyerID;
            document.getElementById("ContractDialogBuyerPublicKey").innerHTML = "Buyer Public-Key : ".bold() + BuyerPublicKeyToShow;

            if (offer.RegulatorSign == true) {
                document.getElementById("ContractDialogNewOwnerID").style.display = "block";
                document.getElementById("ContractDialogNewOwnerPublicKey").style.display = "block";
                var fullPublicKey = offer.NewOwnerPublicKey;
                var partOne = fullPublicKey.substring(0, 12);
                var partTwo = " . . . ";
                var partThree = fullPublicKey.substring(32, fullPublicKey.length);
                var NewOwnerPublicKeyToShow = "" + partOne + partTwo + partThree;


                document.getElementById("ContractDialogNewOwnerID").innerHTML = "New Owner ID : ".bold() + offer.BuyerID;
                document.getElementById("ContractDialogNewOwnerPublicKey").innerHTML = "New Owner Public-Key : ".bold() + NewOwnerPublicKeyToShow;
                document.getElementById("ContractDialogResult").innerHTML = "Approved";
                document.getElementById("ContractDialogResult").style.color = "lightgreen";

            }
            else
            {
                document.getElementById("ContractDialogNewOwnerID").style.display = "block";
                document.getElementById("ContractDialogNewOwnerPublicKey").style.display = "block";
                document.getElementById("ContractDialogResult").innerHTML = "Denied By Regulaotr";
                document.getElementById("ContractDialogResult").style.color = "red";
                

            }


    

        }
      
    </script>
}